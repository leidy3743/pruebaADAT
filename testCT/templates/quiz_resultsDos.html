{% extends "layouts/base.html" %}

{% block title %}Resultados por Estilos de Aprendizaje{% endblock %}

{% block stylesheets %}
<style>
  .result-card {
    background-color: #ffffff;
    border-radius: 12px;
    box-shadow: 0 4px 8px rgba(0, 0, 0, 0.1);
    padding: 20px;
    margin-bottom: 30px;
  }

  .result-list {
    list-style-type: none;
    padding-left: 0;
    margin-bottom: 20px;
  }

  .result-list li {
    font-size: 18px;
    padding: 8px 12px;
    margin: 5px 0;
    background-color: #f1f1f1;
    border-radius: 8px;
    transition: background-color 0.3s;
  }

  .result-list li:hover {
    background-color: #e0e0e0; /* Cambio de color al pasar el ratón */
  }

  #chart {
    margin-top: 30px;
    width: 100%;
    height: 500px;
  }

  .footer {
    background-color: #f8f9fa;
    border-top: 1px solid #eaeaea;
    padding: 20px 0;
  }
</style>

<style>
    /* Estilos para mejorar la apariencia del acordeón */
    .accordion-item {
        border: none; /* Elimina el borde blanco */
        background-color: #f8f9fa; /* Color de fondo gris claro */
        margin: 8px 10px; /* Espaciado entre los elementos */
        border-radius: 5px; /* Bordes redondeados */
    }

    /* Agregar icono de flecha */
    .accordion-button {
        padding: 12px 20px; /* Espaciado interno más amplio */
        background-color: #e9ecef; /* Color de fondo del botón */
        border: none; /* Quita bordes blancos */
        box-shadow: none; /* Evita sombras al hacer clic */
    }

    /* Flecha hacia abajo */
    .accordion-button::after {
        content: "\25BC"; /* Unicode de una flecha hacia abajo */
        font-size: 14px;
        transition: transform 0.3s ease-in-out;
        margin-left: auto; /* Alinear la flecha a la derecha */
    }

    /* Rotar la flecha cuando el acordeón está abierto */
    .accordion-button:not(.collapsed)::after {
        transform: rotate(180deg);
    }

    /* Estilo del cuerpo del acordeón */
    .accordion-body {
        background-color: #f8f9fa; /* Fondo gris claro */
        padding: 15px;
    }
</style>
{% endblock stylesheets %}

{% block content %}
<div class="container-fluid py-4">
    <div class="row">
        <div class="col-12">
            <div class="card my-4 result-card">
                <div class="card-header p-0 position-relative mt-n4 mx-3 z-index-2">
                    <div class="bg-gradient-primary shadow-primary border-radius-lg pt-4 pb-3">
                        <h6 class="text-white text-capitalize ps-3">Resultados por Estilos de Aprendizaje</h6>
                    </div>
                </div>
                <div class="card-body px-4 pb-2">
                    <div class="table-responsive p-0">
                        <h8 class="text-primary">Este cuestionario clasifica las preferencias de aprendizaje basado en el modelo de Felder-Silverman teniendo en cuenta cuatro dimensiones.</h8>
                        <br>                        
                        <div class="accordion" id="accordionEtiquetas">
                            {% for etiqueta, resultados in etiqueta_resultados.items() %}
                            <div class="accordion-item">
                                <h2 class="accordion-header" id="heading{{ loop.index }}">
                                    <button class="accordion-button collapsed bg-light" type="button" data-bs-toggle="collapse" data-bs-target="#collapse{{ loop.index }}" aria-expanded="false" aria-controls="collapse{{ loop.index }}">
                                        <strong>{{ etiqueta }}</strong>: Resultado: {{ resultados.estado }}, Nivel: {{ resultados.valor }}, Valor: {{ resultados.total }}
                                    </button>
                                </h2>
                                <div id="collapse{{ loop.index }}" class="accordion-collapse collapse" aria-labelledby="heading{{ loop.index }}" data-bs-parent="#accordionEtiquetas">
                                    <div class="accordion-body bg-light">
                                    {{ etiqueta_descriptions[etiqueta] }}
                                    </div>
                                </div>
                            </div>
                            {% endfor %}
                        </div>
                    </div>
                    <div id="chart"></div> <!-- Aquí se mostrará la gráfica -->
                </div>
            </div>
        </div>
    </div>
</div>
<footer class="footer py-4">
    <div class="container-fluid">
        <div class="row align-items-center justify-content-lg-between">
            <div class="col-lg-6 mb-lg-0 mb-4 text-center text-sm text-muted text-lg-start">
                © <script>document.write(new Date().getFullYear())</script>,
                <i class="fa fa-heart"></i>
                <a href="https://www.creative-tim.com" class="font-weight-bold" target="_blank">Creative by</a>
                Leidy Carvajal.
            </div>
            <div class="col-lg-6">
                <ul class="nav nav-footer justify-content-center justify-content-lg-end">
                    <li class="nav-item"><a href="https://www.creative-tim.com" class="nav-link text-white" target="_blank">Creative Tim</a></li>
                    <li class="nav-item"><a href="https://www.creative-tim.com/presentation" class="nav-link text-white" target="_blank">About Us</a></li>
                    <li class="nav-item"><a href="https://www.creative-tim.com/blog" class="nav-link text-white" target="_blank">Blog</a></li>
                    <li class="nav-item"><a href="https://www.creative-tim.com/license" class="nav-link pe-0 text-white" target="_blank">License</a></li>
                </ul>
            </div>
        </div>
    </div>
</footer>
{% endblock content %}

{% block javascripts %}
<script src="https://cdn.plot.ly/plotly-latest.min.js"></script>
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.1/css/all.min.css"/>

<script>
document.addEventListener("DOMContentLoaded", function () {
    document.querySelectorAll(".accordion-button").forEach(button => {
        button.addEventListener("click", function () {
            let target = document.querySelector(this.getAttribute("data-bs-target"));

            if (target.classList.contains("show")) {
                let collapse = new bootstrap.Collapse(target);
                collapse.hide();  // Cierra si ya está abierto
            } 
        });
    });
});
</script>
<script>
  document.addEventListener("DOMContentLoaded", function() {
      const etiquetaResultados = {{ etiqueta_resultados | tojson }};
      
      const etiquetas = Object.keys(etiquetaResultados);
      const valores = etiquetas.map(etiqueta => etiquetaResultados[etiqueta].total || 0); // Asegúrate de que 'total' sea un valor numérico
      
      const colores = etiquetas.map(etiqueta => {
          const nivel = etiquetaResultados[etiqueta].valor;
          return nivel === 'Apropiado' ? '#43A047' : nivel === 'Moderado' ? '#FB8C00' : nivel === 'Fuerte' ? '#E53935' : 'gray';
      });

      const data = [{
          x: etiquetas,
          y: valores,
          type: 'bar',
          marker: {
              color: colores,
            },
          text: valores.map((valor, index) => `Valor: ${valor}<br>Resultado: ${etiquetaResultados[etiquetas[index]].estado}<br>Nivel: ${etiquetaResultados[etiquetas[index]].valor}`), // Texto para mostrar en la leyenda
          hoverinfo: 'text' // Mostrar solo el texto al pasar el mouse
      }];

      const layout = {
          title: 'Resultados por Estilos de Aprendizaje',
          xaxis: { title: 'Estilos de Aprendizaje' },
          yaxis: { title: 'Resultado', showticklabels: true },
          showlegend: false,
      };

      Plotly.newPlot('chart', data, layout);
  });
</script>
{% endblock javascripts %}
